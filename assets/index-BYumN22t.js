var pr=Object.defineProperty;var xt=e=>{throw TypeError(e)};var lr=(e,t,r)=>t in e?pr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var y=(e,t,r)=>lr(e,typeof t!="symbol"?t+"":t,r),qe=(e,t,r)=>t.has(e)||xt("Cannot "+r);var s=(e,t,r)=>(qe(e,t,"read from private field"),r?r.call(e):t.get(e)),f=(e,t,r)=>t.has(e)?xt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),u=(e,t,r,n)=>(qe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),l=(e,t,r)=>(qe(e,t,"access private method"),r);var w,g,Dt,re=(Dt=class{constructor(e){f(this,w);f(this,g,0);u(this,w,new DataView(e.buffer)),u(this,g,e.byteOffset)}get offset(){return s(this,g)}readUInt8Array(){const e=this.readU32(),t=new Uint8Array(s(this,w).buffer,s(this,g),e);return u(this,g,s(this,g)+e),t}readBool(){const e=s(this,w).getUint8(s(this,g));return u(this,g,s(this,g)+1),e!==0}readByte(){const e=s(this,w).getUint8(s(this,g));return u(this,g,s(this,g)+1),e}readBytes(e){const t=new DataView(s(this,w).buffer,s(this,g),e);return u(this,g,s(this,g)+e),new Uint8Array(t.buffer)}readI8(){const e=s(this,w).getInt8(s(this,g));return u(this,g,s(this,g)+1),e}readU8(){const e=s(this,w).getUint8(s(this,g));return u(this,g,s(this,g)+1),e}readI16(){const e=s(this,w).getInt16(s(this,g),!0);return u(this,g,s(this,g)+2),e}readU16(){const e=s(this,w).getUint16(s(this,g),!0);return u(this,g,s(this,g)+2),e}readI32(){const e=s(this,w).getInt32(s(this,g),!0);return u(this,g,s(this,g)+4),e}readU32(){const e=s(this,w).getUint32(s(this,g),!0);return u(this,g,s(this,g)+4),e}readI64(){const e=s(this,w).getBigInt64(s(this,g),!0);return u(this,g,s(this,g)+8),e}readU64(){const e=s(this,w).getBigUint64(s(this,g),!0);return u(this,g,s(this,g)+8),e}readU128(){const e=s(this,w).getBigUint64(s(this,g),!0),t=s(this,w).getBigUint64(s(this,g)+8,!0);return u(this,g,s(this,g)+16),(t<<BigInt(64))+e}readI128(){const e=s(this,w).getBigUint64(s(this,g),!0),t=s(this,w).getBigInt64(s(this,g)+8,!0);return u(this,g,s(this,g)+16),(t<<BigInt(64))+e}readU256(){const e=s(this,w).getBigUint64(s(this,g),!0),t=s(this,w).getBigUint64(s(this,g)+8,!0),r=s(this,w).getBigUint64(s(this,g)+16,!0),n=s(this,w).getBigUint64(s(this,g)+24,!0);return u(this,g,s(this,g)+32),(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readI256(){const e=s(this,w).getBigUint64(s(this,g),!0),t=s(this,w).getBigUint64(s(this,g)+8,!0),r=s(this,w).getBigUint64(s(this,g)+16,!0),n=s(this,w).getBigInt64(s(this,g)+24,!0);return u(this,g,s(this,g)+32),(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readF32(){const e=s(this,w).getFloat32(s(this,g),!0);return u(this,g,s(this,g)+4),e}readF64(){const e=s(this,w).getFloat64(s(this,g),!0);return u(this,g,s(this,g)+8),e}readString(){const e=this.readU32(),t=new Uint8Array(s(this,w).buffer,s(this,g),e),n=new TextDecoder("utf-8").decode(t);return u(this,g,s(this,g)+e),n}},w=new WeakMap,g=new WeakMap,Dt),E,I,d,C,O,Nt,N=(Nt=class{constructor(e){f(this,C);f(this,E);f(this,I);f(this,d,0);u(this,E,new Uint8Array(e)),u(this,I,new DataView(s(this,E).buffer))}getBuffer(){return s(this,E).slice(0,s(this,d))}writeUInt8Array(e){const t=e.length;l(this,C,O).call(this,4+t),this.writeU32(t),s(this,E).set(e,s(this,d)),u(this,d,s(this,d)+e.length)}writeBool(e){l(this,C,O).call(this,1),s(this,I).setUint8(s(this,d),e?1:0),u(this,d,s(this,d)+1)}writeByte(e){l(this,C,O).call(this,1),s(this,I).setUint8(s(this,d),e),u(this,d,s(this,d)+1)}writeI8(e){l(this,C,O).call(this,1),s(this,I).setInt8(s(this,d),e),u(this,d,s(this,d)+1)}writeU8(e){l(this,C,O).call(this,1),s(this,I).setUint8(s(this,d),e),u(this,d,s(this,d)+1)}writeI16(e){l(this,C,O).call(this,2),s(this,I).setInt16(s(this,d),e,!0),u(this,d,s(this,d)+2)}writeU16(e){l(this,C,O).call(this,2),s(this,I).setUint16(s(this,d),e,!0),u(this,d,s(this,d)+2)}writeI32(e){l(this,C,O).call(this,4),s(this,I).setInt32(s(this,d),e,!0),u(this,d,s(this,d)+4)}writeU32(e){l(this,C,O).call(this,4),s(this,I).setUint32(s(this,d),e,!0),u(this,d,s(this,d)+4)}writeI64(e){l(this,C,O).call(this,8),s(this,I).setBigInt64(s(this,d),e,!0),u(this,d,s(this,d)+8)}writeU64(e){l(this,C,O).call(this,8),s(this,I).setBigUint64(s(this,d),e,!0),u(this,d,s(this,d)+8)}writeU128(e){l(this,C,O).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);s(this,I).setBigUint64(s(this,d),t,!0),s(this,I).setBigUint64(s(this,d)+8,r,!0),u(this,d,s(this,d)+16)}writeI128(e){l(this,C,O).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);s(this,I).setBigInt64(s(this,d),t,!0),s(this,I).setBigInt64(s(this,d)+8,r,!0),u(this,d,s(this,d)+16)}writeU256(e){l(this,C,O).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,c=e>>BigInt(64*3);s(this,I).setBigUint64(s(this,d)+8*0,r,!0),s(this,I).setBigUint64(s(this,d)+8*1,n,!0),s(this,I).setBigUint64(s(this,d)+8*2,i,!0),s(this,I).setBigUint64(s(this,d)+8*3,c,!0),u(this,d,s(this,d)+32)}writeI256(e){l(this,C,O).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,c=e>>BigInt(64*3);s(this,I).setBigUint64(s(this,d)+8*0,r,!0),s(this,I).setBigUint64(s(this,d)+8*1,n,!0),s(this,I).setBigUint64(s(this,d)+8*2,i,!0),s(this,I).setBigInt64(s(this,d)+8*3,c,!0),u(this,d,s(this,d)+32)}writeF32(e){l(this,C,O).call(this,4),s(this,I).setFloat32(s(this,d),e,!0),u(this,d,s(this,d)+4)}writeF64(e){l(this,C,O).call(this,8),s(this,I).setFloat64(s(this,d),e,!0),u(this,d,s(this,d)+8)}writeString(e){const r=new TextEncoder().encode(e);this.writeU32(r.length),l(this,C,O).call(this,r.length),s(this,E).set(r,s(this,d)),u(this,d,s(this,d)+r.length)}},E=new WeakMap,I=new WeakMap,d=new WeakMap,C=new WeakSet,O=function(e){const t=s(this,d)+e+1;if(t<=s(this,E).length)return;let r=s(this,E).length*2;r<t&&(r=t);const n=new Uint8Array(r);n.set(s(this,E)),u(this,E,n),u(this,I,new DataView(s(this,E).buffer))},Nt);function ye(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r)if(!n.includes(i)||!ye(e[i],t[i]))return!1;return!0}function Kt(e){return Array.prototype.map.call(e,t=>("00"+t.toString(16)).slice(-2)).join("")}function ur(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new re(e).readU128()}function yr(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new re(e).readU256()}function Vt(e){e.startsWith("0x")&&(e=e.slice(2));let t=e.match(/.{1,2}/g)||[],r=Uint8Array.from(t.map(n=>parseInt(n,16)));return r.length!=32?new Uint8Array(0):r}function gr(e){return ur(Vt(e))}function dr(e){return yr(Vt(e))}function Gt(e){let t=new N(16);return t.writeU128(e),t.getBuffer()}function hr(e){return Kt(Gt(e))}function Zt(e){let t=new N(32);return t.writeU256(e),t.getBuffer()}function Tr(e){return Kt(Zt(e))}var Me=class ze{constructor(t){y(this,"data");this.data=t}get __connection_id__(){return this.data}isZero(){return this.data===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let r=BigInt(0);for(let n=0;n<16;n++)r=r<<BigInt(8)|BigInt(t());return new ze(r)}isEqual(t){return this.data==t.data}toHexString(){return hr(this.data)}toUint8Array(){return Gt(this.data)}static fromString(t){return new ze(gr(t))}static fromStringOrNull(t){let r=ze.fromString(t);return r.isZero()?null:r}},L,br=(L=class{constructor(t){y(this,"__time_duration_micros__");this.__time_duration_micros__=t}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/L.MICROS_PER_MILLIS)}static fromMillis(t){return new L(BigInt(t)*L.MICROS_PER_MILLIS)}},y(L,"MICROS_PER_MILLIS",1000n),L),D,fr=(D=class{constructor(t){y(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static now(){return D.fromDate(new Date)}static fromDate(t){const r=t.getTime(),n=BigInt(r)*D.MICROS_PER_MILLIS;return new D(n)}toDate(){const r=this.__timestamp_micros_since_unix_epoch__/D.MICROS_PER_MILLIS;if(r>BigInt(Number.MAX_SAFE_INTEGER)||r<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(r))}},y(D,"MICROS_PER_MILLIS",1000n),y(D,"UNIX_EPOCH",new D(0n)),D),mr=class Jt{constructor(t){y(this,"data");this.data=typeof t=="string"?dr(t):t}get __identity__(){return this.data}isEqual(t){return this.toHexString()===t.toHexString()}toHexString(){return Tr(this.data)}toUint8Array(){return Zt(this.data)}static fromString(t){return new Jt(t)}},Le;(e=>{function t(){return a.createSumType([new _("Interval",a.createU64Type()),new _("Time",a.createU64Type())])}e.getAlgebraicType=t;function r(i){switch(i.tag){case"Interval":return{Interval:i.value};case"Time":return{Time:i.value};default:throw"unreachable"}}e.serialize=r,e.Interval=i=>({tag:"Interval",value:i}),e.Time=i=>({tag:"Time",value:i});function n(i){let c=i.asSumValue();switch(c.tag){case 0:return{tag:"Interval",value:c.value.asBigInt()};case 1:return{tag:"Time",value:c.value.asBigInt()};default:throw"unreachable"}}e.fromValue=n})(Le||(Le={}));var wr=Le,_=class{constructor(e,t){y(this,"name");y(this,"algebraicType");this.name=e,this.algebraicType=t}},Sr=class{constructor(e){y(this,"variants");y(this,"serialize",(e,t)=>{if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none")t?(e.writeByte(0),this.variants[0].algebraicType.serialize(e,t)):e.writeByte(1);else{let r=t.tag;const n=this.variants.findIndex(i=>i.name===r);if(n<0)throw`Can't serialize a sum type, couldn't find ${t.tag} tag`;e.writeU8(n),this.variants[n].algebraicType.serialize(e,t.value)}});y(this,"deserialize",e=>{let t=e.readU8();if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none"){if(t===0)return this.variants[0].algebraicType.deserialize(e);if(t===1)return;throw`Can't deserialize an option type, couldn't find ${t} tag`}else{let r=this.variants[t],n=r.algebraicType.deserialize(e);return{tag:r.name,value:n}}});this.variants=e}},o=class{constructor(e,t){y(this,"name");y(this,"algebraicType");this.name=e,this.algebraicType=t}},Ar=class{constructor(e){y(this,"elements");y(this,"serialize",(e,t)=>{for(let r of this.elements)r.algebraicType.serialize(e,t[r.name])});y(this,"deserialize",e=>{let t={};if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return new br(e.readI64());if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new fr(e.readI64());if(this.elements[0].name==="__identity__")return new mr(e.readU256());if(this.elements[0].name==="__connection_id__")return new Me(e.readU128())}for(let r of this.elements)t[r.name]=r.algebraicType.deserialize(e);return t});this.elements=e}isEmpty(){return this.elements.length===0}},zr=class{constructor(e,t){y(this,"keyType");y(this,"valueType");this.keyType=e,this.valueType=t}},P,ee,U,G,v,He,$e,We,a=(G=class{constructor(){f(this,P);y(this,"type");y(this,"type_")}get product(){if(this.type!==p.ProductType)throw"product type was requested, but the type is not ProductType";return this.type_}set product(t){l(this,P,ee).call(this,p.ProductType,t)}get sum(){if(this.type!==p.SumType)throw"sum type was requested, but the type is not SumType";return this.type_}set sum(t){l(this,P,ee).call(this,p.SumType,t)}get array(){if(this.type!==p.ArrayType)throw"array type was requested, but the type is not ArrayType";return this.type_}set array(t){l(this,P,ee).call(this,p.ArrayType,t)}get map(){if(this.type!==p.MapType)throw"map type was requested, but the type is not MapType";return this.type_}set map(t){l(this,P,ee).call(this,p.MapType,t)}static createProductType(t){return l(this,U,v).call(this,p.ProductType,new Ar(t))}static createSumType(t){return l(this,U,v).call(this,p.SumType,new Sr(t))}static createArrayType(t){return l(this,U,v).call(this,p.ArrayType,t)}static createMapType(t,r){return l(this,U,v).call(this,p.MapType,new zr(t,r))}static createBoolType(){return l(this,U,v).call(this,p.Bool,null)}static createI8Type(){return l(this,U,v).call(this,p.I8,null)}static createU8Type(){return l(this,U,v).call(this,p.U8,null)}static createI16Type(){return l(this,U,v).call(this,p.I16,null)}static createU16Type(){return l(this,U,v).call(this,p.U16,null)}static createI32Type(){return l(this,U,v).call(this,p.I32,null)}static createU32Type(){return l(this,U,v).call(this,p.U32,null)}static createI64Type(){return l(this,U,v).call(this,p.I64,null)}static createU64Type(){return l(this,U,v).call(this,p.U64,null)}static createI128Type(){return l(this,U,v).call(this,p.I128,null)}static createU128Type(){return l(this,U,v).call(this,p.U128,null)}static createI256Type(){return l(this,U,v).call(this,p.I256,null)}static createU256Type(){return l(this,U,v).call(this,p.U256,null)}static createF32Type(){return l(this,U,v).call(this,p.F32,null)}static createF64Type(){return l(this,U,v).call(this,p.F64,null)}static createStringType(){return l(this,U,v).call(this,p.String,null)}static createBytesType(){return this.createArrayType(this.createU8Type())}static createOptionType(t){return this.createSumType([new _("some",t),new _("none",this.createProductType([]))])}static createIdentityType(){return this.createProductType([new o("__identity__",this.createU256Type())])}static createConnectionIdType(){return this.createProductType([new o("__connection_id__",this.createU128Type())])}static createScheduleAtType(){return wr.getAlgebraicType()}static createTimestampType(){return this.createProductType([new o("__timestamp_micros_since_unix_epoch__",this.createI64Type())])}static createTimeDurationType(){return this.createProductType([new o("__time_duration_micros__",this.createI64Type())])}isProductType(){return this.type===p.ProductType}isSumType(){return this.type===p.SumType}isArrayType(){return this.type===p.ArrayType}isMapType(){return this.type===p.MapType}isIdentity(){return l(this,P,$e).call(this,"__identity__")}isConnectionId(){return l(this,P,$e).call(this,"__connection_id__")}isScheduleAt(){return this.isSumType()&&this.sum.variants.length===2&&this.sum.variants[0].name==="Interval"&&this.sum.variants[0].algebraicType.type===p.U64&&this.sum.variants[1].name==="Time"&&this.sum.variants[1].algebraicType.type===p.U64}isTimestamp(){return l(this,P,We).call(this,"__timestamp_micros_since_unix_epoch__")}isTimeDuration(){return l(this,P,We).call(this,"__time_duration_micros__")}serialize(t,r){switch(this.type){case p.ProductType:this.product.serialize(t,r);break;case p.SumType:this.sum.serialize(t,r);break;case p.ArrayType:if(l(this,P,He).call(this))t.writeUInt8Array(r);else{const n=this.array;t.writeU32(r.length);for(let i of r)n.serialize(t,i)}break;case p.MapType:throw new Error("not implemented");case p.Bool:t.writeBool(r);break;case p.I8:t.writeI8(r);break;case p.U8:t.writeU8(r);break;case p.I16:t.writeI16(r);break;case p.U16:t.writeU16(r);break;case p.I32:t.writeI32(r);break;case p.U32:t.writeU32(r);break;case p.I64:t.writeI64(r);break;case p.U64:t.writeU64(r);break;case p.I128:t.writeI128(r);break;case p.U128:t.writeU128(r);break;case p.I256:t.writeI256(r);break;case p.U256:t.writeU256(r);break;case p.F32:t.writeF32(r);break;case p.F64:t.writeF64(r);break;case p.String:t.writeString(r);break;default:throw new Error(`not implemented, ${this.type}`)}}deserialize(t){switch(this.type){case p.ProductType:return this.product.deserialize(t);case p.SumType:return this.sum.deserialize(t);case p.ArrayType:if(l(this,P,He).call(this))return t.readUInt8Array();{const r=this.array,n=t.readU32();let i=[];for(let c=0;c<n;c++)i.push(r.deserialize(t));return i}case p.MapType:throw new Error("not implemented");case p.Bool:return t.readBool();case p.I8:return t.readI8();case p.U8:return t.readU8();case p.I16:return t.readI16();case p.U16:return t.readU16();case p.I32:return t.readI32();case p.U32:return t.readU32();case p.I64:return t.readI64();case p.U64:return t.readU64();case p.I128:return t.readI128();case p.U128:return t.readU128();case p.U256:return t.readU256();case p.F32:return t.readF32();case p.F64:return t.readF64();case p.String:return t.readString();default:throw new Error(`not implemented, ${this.type}`)}}},P=new WeakSet,ee=function(t,r){this.type_=r,this.type=r===void 0?p.None:t},U=new WeakSet,v=function(t,r){var i;let n=new G;return l(i=n,P,ee).call(i,t,r),n},He=function(){return this.isArrayType()&&this.array.type==p.U8},$e=function(t){return this.isProductType()&&this.product.elements.length===1&&(this.product.elements[0].algebraicType.type==p.U128||this.product.elements[0].algebraicType.type==p.U256)&&this.product.elements[0].name===t},We=function(t){return this.isProductType()&&this.product.elements.length===1&&this.product.elements[0].algebraicType.type===p.I64&&this.product.elements[0].name===t},f(G,U),G);(e=>{(t=>{t.SumType="SumType",t.ProductType="ProductType",t.ArrayType="ArrayType",t.MapType="MapType",t.Bool="Bool",t.I8="I8",t.U8="U8",t.I16="I16",t.U16="U16",t.I32="I32",t.U32="U32",t.I64="I64",t.U64="U64",t.I128="I128",t.U128="U128",t.I256="I256",t.U256="U256",t.F32="F32",t.F64="F64",t.String="String",t.None="None"})(e.Type||(e.Type={}))})(a);var p=a.Type;function Ir(e,t){const r=new re(t);return e.deserialize(r)}var Ke;(e=>{e.FixedSize=i=>({tag:"FixedSize",value:i}),e.RowOffsets=i=>({tag:"RowOffsets",value:i});function t(){return a.createSumType([new _("FixedSize",a.createU16Type()),new _("RowOffsets",a.createArrayType(a.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ke||(Ke={}));var he;(e=>{function t(){return a.createProductType([new o("sizeHint",Ke.getTypeScriptAlgebraicType()),new o("rowsData",a.createArrayType(a.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(he||(he={}));var Ve;(e=>{function t(){return a.createProductType([new o("reducer",a.createStringType()),new o("args",a.createArrayType(a.createU8Type())),new o("requestId",a.createU32Type()),new o("flags",a.createU8Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ve||(Ve={}));var Ge;(e=>{function t(){return a.createProductType([new o("queryStrings",a.createArrayType(a.createStringType())),new o("requestId",a.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ge||(Ge={}));var Ze;(e=>{function t(){return a.createProductType([new o("messageId",a.createArrayType(a.createU8Type())),new o("queryString",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ze||(Ze={}));var q;(e=>{function t(){return a.createProductType([new o("id",a.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(q||(q={}));var Je;(e=>{function t(){return a.createProductType([new o("query",a.createStringType()),new o("requestId",a.createU32Type()),new o("queryId",q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Je||(Je={}));var Xe;(e=>{function t(){return a.createProductType([new o("queryStrings",a.createArrayType(a.createStringType())),new o("requestId",a.createU32Type()),new o("queryId",q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Xe||(Xe={}));var Ye;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("queryId",q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ye||(Ye={}));var je;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("queryId",q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(je||(je={}));var te;(e=>{e.CallReducer=i=>({tag:"CallReducer",value:i}),e.Subscribe=i=>({tag:"Subscribe",value:i}),e.OneOffQuery=i=>({tag:"OneOffQuery",value:i}),e.SubscribeSingle=i=>({tag:"SubscribeSingle",value:i}),e.SubscribeMulti=i=>({tag:"SubscribeMulti",value:i}),e.Unsubscribe=i=>({tag:"Unsubscribe",value:i}),e.UnsubscribeMulti=i=>({tag:"UnsubscribeMulti",value:i});function t(){return a.createSumType([new _("CallReducer",Ve.getTypeScriptAlgebraicType()),new _("Subscribe",Ge.getTypeScriptAlgebraicType()),new _("OneOffQuery",Ze.getTypeScriptAlgebraicType()),new _("SubscribeSingle",Je.getTypeScriptAlgebraicType()),new _("SubscribeMulti",Xe.getTypeScriptAlgebraicType()),new _("Unsubscribe",Ye.getTypeScriptAlgebraicType()),new _("UnsubscribeMulti",je.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(te||(te={}));var _e;(e=>{function t(){return a.createProductType([new o("deletes",he.getTypeScriptAlgebraicType()),new o("inserts",he.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(_e||(_e={}));var Qe;(e=>{e.Uncompressed=i=>({tag:"Uncompressed",value:i}),e.Brotli=i=>({tag:"Brotli",value:i}),e.Gzip=i=>({tag:"Gzip",value:i});function t(){return a.createSumType([new _("Uncompressed",_e.getTypeScriptAlgebraicType()),new _("Brotli",a.createArrayType(a.createU8Type())),new _("Gzip",a.createArrayType(a.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Qe||(Qe={}));var Ue;(e=>{function t(){return a.createProductType([new o("tableId",a.createU32Type()),new o("tableName",a.createStringType()),new o("numRows",a.createU64Type()),new o("updates",a.createArrayType(Qe.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ue||(Ue={}));var Q;(e=>{function t(){return a.createProductType([new o("tables",a.createArrayType(Ue.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Q||(Q={}));var et;(e=>{function t(){return a.createProductType([new o("quanta",a.createU128Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(et||(et={}));var tt;(e=>{function t(){return a.createProductType([new o("identity",a.createIdentityType()),new o("token",a.createStringType()),new o("connectionId",a.createConnectionIdType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(tt||(tt={}));var rt;(e=>{function t(){return a.createProductType([new o("databaseUpdate",Q.getTypeScriptAlgebraicType()),new o("requestId",a.createU32Type()),new o("totalHostExecutionDuration",a.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(rt||(rt={}));var it;(e=>{function t(){return a.createProductType([new o("tableName",a.createStringType()),new o("rows",he.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(it||(it={}));var nt;(e=>{function t(){return a.createProductType([new o("messageId",a.createArrayType(a.createU8Type())),new o("error",a.createOptionType(a.createStringType())),new o("tables",a.createArrayType(it.getTypeScriptAlgebraicType())),new o("totalHostExecutionDuration",a.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(nt||(nt={}));var st;(e=>{function t(){return a.createProductType([new o("reducerName",a.createStringType()),new o("reducerId",a.createU32Type()),new o("args",a.createArrayType(a.createU8Type())),new o("requestId",a.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(st||(st={}));var at;(e=>{e.Committed=i=>({tag:"Committed",value:i}),e.Failed=i=>({tag:"Failed",value:i}),e.OutOfEnergy={tag:"OutOfEnergy"};function t(){return a.createSumType([new _("Committed",Q.getTypeScriptAlgebraicType()),new _("Failed",a.createStringType()),new _("OutOfEnergy",a.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(at||(at={}));var ct;(e=>{function t(){return a.createProductType([new o("status",at.getTypeScriptAlgebraicType()),new o("timestamp",a.createTimestampType()),new o("callerIdentity",a.createIdentityType()),new o("callerConnectionId",a.createConnectionIdType()),new o("reducerCall",st.getTypeScriptAlgebraicType()),new o("energyQuantaUsed",et.getTypeScriptAlgebraicType()),new o("totalHostExecutionDuration",a.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ct||(ct={}));var ot;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("update",Q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ot||(ot={}));var ve;(e=>{function t(){return a.createProductType([new o("tableId",a.createU32Type()),new o("tableName",a.createStringType()),new o("tableRows",Ue.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ve||(ve={}));var pt;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("totalHostExecutionDurationMicros",a.createU64Type()),new o("queryId",q.getTypeScriptAlgebraicType()),new o("rows",ve.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(pt||(pt={}));var lt;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("totalHostExecutionDurationMicros",a.createU64Type()),new o("queryId",q.getTypeScriptAlgebraicType()),new o("rows",ve.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(lt||(lt={}));var ut;(e=>{function t(){return a.createProductType([new o("totalHostExecutionDurationMicros",a.createU64Type()),new o("requestId",a.createOptionType(a.createU32Type())),new o("queryId",a.createOptionType(a.createU32Type())),new o("tableId",a.createOptionType(a.createU32Type())),new o("error",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ut||(ut={}));var yt;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("totalHostExecutionDurationMicros",a.createU64Type()),new o("queryId",q.getTypeScriptAlgebraicType()),new o("update",Q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(yt||(yt={}));var gt;(e=>{function t(){return a.createProductType([new o("requestId",a.createU32Type()),new o("totalHostExecutionDurationMicros",a.createU64Type()),new o("queryId",q.getTypeScriptAlgebraicType()),new o("update",Q.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(gt||(gt={}));var dt;(e=>{e.InitialSubscription=i=>({tag:"InitialSubscription",value:i}),e.TransactionUpdate=i=>({tag:"TransactionUpdate",value:i}),e.TransactionUpdateLight=i=>({tag:"TransactionUpdateLight",value:i}),e.IdentityToken=i=>({tag:"IdentityToken",value:i}),e.OneOffQueryResponse=i=>({tag:"OneOffQueryResponse",value:i}),e.SubscribeApplied=i=>({tag:"SubscribeApplied",value:i}),e.UnsubscribeApplied=i=>({tag:"UnsubscribeApplied",value:i}),e.SubscriptionError=i=>({tag:"SubscriptionError",value:i}),e.SubscribeMultiApplied=i=>({tag:"SubscribeMultiApplied",value:i}),e.UnsubscribeMultiApplied=i=>({tag:"UnsubscribeMultiApplied",value:i});function t(){return a.createSumType([new _("InitialSubscription",rt.getTypeScriptAlgebraicType()),new _("TransactionUpdate",ct.getTypeScriptAlgebraicType()),new _("TransactionUpdateLight",ot.getTypeScriptAlgebraicType()),new _("IdentityToken",tt.getTypeScriptAlgebraicType()),new _("OneOffQueryResponse",nt.getTypeScriptAlgebraicType()),new _("SubscribeApplied",pt.getTypeScriptAlgebraicType()),new _("UnsubscribeApplied",lt.getTypeScriptAlgebraicType()),new _("SubscriptionError",ut.getTypeScriptAlgebraicType()),new _("SubscribeMultiApplied",yt.getTypeScriptAlgebraicType()),new _("UnsubscribeMultiApplied",gt.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(dt||(dt={}));var Z,qt,Ne=(qt=class{constructor(){f(this,Z,new Map)}on(e,t){let r=s(this,Z).get(e);r||(r=new Set,s(this,Z).set(e,r)),r.add(t)}off(e,t){let r=s(this,Z).get(e);r&&r.delete(t)}emit(e,...t){let r=s(this,Z).get(e);if(r)for(let n of r)n(...t)}},Z=new WeakMap,qt),R,J,ge,Mt,Et=(Mt=class{constructor(){f(this,J);f(this,R,[])}set(e,t){const r=s(this,R).findIndex(({key:n})=>l(this,J,ge).call(this,n,e));r>-1?s(this,R)[r].value=t:s(this,R).push({key:e,value:t})}get(e){const t=s(this,R).find(({key:r})=>l(this,J,ge).call(this,r,e));return t?t.value:void 0}delete(e){const t=s(this,R).findIndex(({key:r})=>l(this,J,ge).call(this,r,e));return t>-1?(s(this,R).splice(t,1),!0):!1}has(e){return s(this,R).some(({key:t})=>l(this,J,ge).call(this,t,e))}values(){return s(this,R).map(e=>e.value)}entries(){return s(this,R)}[Symbol.iterator](){let e=0;const t=s(this,R);return{next(){return e<t.length?{value:t[e++],done:!1}:{value:null,done:!0}}}}},R=new WeakMap,J=new WeakSet,ge=function(e,t){return e&&typeof e=="object"&&"isEqual"in e?e.isEqual(t):e===t},Mt),_r={component:"📦",info:"ℹ️",warn:"⚠️",error:"❌",debug:"🐛"},Ur={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},vr={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},de=(e,t)=>{console.log(`%c${_r[e]} ${e.toUpperCase()}%c ${t}`,Ur[e],vr[e])},Cr=class{constructor(e){y(this,"rows");y(this,"tableTypeInfo");y(this,"emitter");y(this,"applyOperations",(e,t)=>{const r=[];if(this.tableTypeInfo.primaryKey!==void 0){const n=this.tableTypeInfo.primaryKey,i=new Et,c=new Et;for(const T of e)if(T.type==="insert"){const[h,b]=i.get(T.row[n])||[T,0];i.set(T.row[n],[T,b+1])}else{const[h,b]=c.get(T.row[n])||[T,0];c.set(T.row[n],[T,b+1])}for(const{key:T,value:[h,b]}of i){const z=c.get(T);if(z){const[m,S]=z,F=b-S,x=this.update(t,h,m,F);x&&r.push(x),c.delete(T)}else{const m=this.insert(t,h,b);m&&r.push(m)}}for(const[T,h]of c.values()){const b=this.delete(t,T,h);b&&r.push(b)}}else for(const n of e)if(n.type==="insert"){const i=this.insert(t,n);i&&r.push(i)}else{const i=this.delete(t,n);i&&r.push(i)}return r});y(this,"update",(e,t,r,n=0)=>{const[i,c]=this.rows.get(r.rowId)||[r.row,0],T=Math.max(1,c+n);return this.rows.delete(r.rowId),this.rows.set(t.rowId,[t.row,T]),c===0?(de("error","Updating a row that was not present in the cache"),{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}):(c+n<=0&&de("error","Negative reference count for row"),{type:"update",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("update",e,i,t.row)}})});y(this,"insert",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,i+r]),i===0)return{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}});y(this,"delete",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(i===0){de("warn","Deleting a row that was not present in the cache");return}if(i<=r)return this.rows.delete(t.rowId),{type:"delete",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,i-r])});y(this,"onInsert",e=>{this.emitter.on("insert",e)});y(this,"onDelete",e=>{this.emitter.on("delete",e)});y(this,"onUpdate",e=>{this.emitter.on("update",e)});y(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});y(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});y(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableTypeInfo=e,this.rows=new Map,this.emitter=new Ne}count(){return this.rows.size}iter(){return Array.from(this.rows.values()).map(([e])=>e)}},Fr=class{constructor(){y(this,"tables");this.tables=new Map}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${e} does not exist`);return t}getOrCreateTable(e){let t;return this.tables.has(e.tableName)?t=this.tables.get(e.tableName):(t=new Cr(e),this.tables.set(e.tableName,t)),t}};async function Xt(e,t,r=128*1024){let n=0;const i=new ReadableStream({pull(x){if(n<e.length){const $=e.subarray(n,Math.min(n+r,e.length));x.enqueue($),n+=r}else x.close()}}),c=new DecompressionStream(t),h=i.pipeThrough(c).getReader(),b=[];let z=0,m;for(;!(m=await h.read()).done;)b.push(m.value),z+=m.value.length;const S=new Uint8Array(z);let F=0;for(const x of b)S.set(x,F),F+=x.length;return S}var ie,H,Yt,jt,ht,ne,Or=(ne=class{constructor(t){f(this,H);y(this,"onclose");y(this,"onopen");y(this,"onmessage");y(this,"onerror");f(this,ie);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=l(this,H,Yt).bind(this),t.onerror=l(this,H,ht).bind(this),t.onclose=l(this,H,ht).bind(this),t.onopen=l(this,H,jt).bind(this),t.binaryType="arraybuffer",u(this,ie,t)}send(t){s(this,ie).send(t)}close(){s(this,ie).close()}static async createWebSocketFn({url:t,wsProtocol:r,authToken:n,compression:i,lightMode:c}){const T=new Headers;let h;if(h=WebSocket,n){T.set("Authorization",`Bearer ${n}`);const z=new URL("/v1/identity/websocket-token",t);z.protocol=t.protocol==="wss:"?"https:":"http:";const m=await fetch(z,{method:"POST",headers:T});if(m.ok){const{token:S}=await m.json();t.searchParams.set("token",S),t.searchParams.set("compression",i==="gzip"?"Gzip":"None"),c&&t.searchParams.set("light","true")}}const b=new h(t,r);return new ne(b)}},ie=new WeakMap,H=new WeakSet,Yt=async function(t){var i;const r=new Uint8Array(t.data);let n;if(r[0]===0)n=r.slice(1);else{if(r[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(r[0]===2)n=await Xt(r.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}(i=this.onmessage)==null||i.call(this,{data:n})},jt=function(t){var r;(r=this.onopen)==null||r.call(this,t)},ht=function(t){var r;(r=this.onerror)==null||r.call(this,t)},ne),se,ae,Ee,Te,X,be,fe,ce,Lt,Br=(Lt=class{constructor(e,t){f(this,se);f(this,ae);f(this,Ee);f(this,Te);f(this,X,new Ne);f(this,be,"gzip");f(this,fe,!1);f(this,ce);this.remoteModule=e,this.dbConnectionConstructor=t,u(this,ce,Or.createWebSocketFn)}withUri(e){return u(this,se,new URL(e)),this}withModuleName(e){return u(this,ae,e),this}withToken(e){return u(this,Te,e),this}withWSFn(e){return u(this,ce,e),this}withCompression(e){return u(this,be,e),this}withLightMode(e){return u(this,fe,e),this}onConnect(e){return s(this,X).on("connect",e),this}onConnectError(e){return s(this,X).on("connectError",e),this}onDisconnect(e){return s(this,X).on("disconnect",e),this}build(){if(!s(this,se))throw new Error("URI is required to connect to SpacetimeDB");if(!s(this,ae))throw new Error("Database name or address is required to connect to SpacetimeDB");return this.dbConnectionConstructor(new er({uri:s(this,se),nameOrAddress:s(this,ae),identity:s(this,Ee),token:s(this,Te),emitter:s(this,X),compression:s(this,be),lightMode:s(this,fe),createWSFn:s(this,ce),remoteModule:this.remoteModule}))}},se=new WeakMap,ae=new WeakMap,Ee=new WeakMap,Te=new WeakMap,X=new WeakMap,be=new WeakMap,fe=new WeakMap,ce=new WeakMap,Lt),me,we,Ht,Qt=(Ht=class{constructor(e){f(this,me);f(this,we);this.db=e}onApplied(e){return u(this,me,e),this}onError(e){return u(this,we,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new kr(this.db,t,s(this,me),s(this,we))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},me=new WeakMap,we=new WeakMap,Ht),Pr=class{constructor(){y(this,"subscriptions",new Map)}},oe,Y,pe,le,j,$t,kr=($t=class{constructor(e,t,r,n){f(this,oe);f(this,Y,!1);f(this,pe,!1);f(this,le,!1);f(this,j,new Ne);this.db=e,this.onError=n,s(this,j).on("applied",i=>{u(this,le,!0),r&&r(i)}),s(this,j).on("error",(i,c)=>{this.onError&&this.onError(i,c)}),u(this,oe,this.db.registerSubscription(this,s(this,j),t))}unsubscribe(){if(s(this,Y))throw new Error("Unsubscribe has already been called");u(this,Y,!0),this.db.unregisterSubscription(s(this,oe)),this.db.unsubscribe(s(this,oe))}unsubscribeThen(e){if(s(this,pe))throw new Error("Subscription has already ended");if(s(this,Y))throw new Error("Unsubscribe has already been called");u(this,Y,!0),s(this,j).on("end",t=>{u(this,pe,!0),u(this,le,!1),e(t)})}isEnded(){return s(this,pe)}isActive(){return s(this,le)}},oe=new WeakMap,Y=new WeakMap,pe=new WeakMap,le=new WeakMap,j=new WeakMap,$t);function xr(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var Se,k,ue,Re,B,Ae,W,De,A,tr,Ie,rr,V,ir,nr,sr,Er,Rr,Dr,Nr,qr,Mr,Lr,Wt,er=(Wt=class{constructor({uri:e,nameOrAddress:t,identity:r,token:n,emitter:i,remoteModule:c,createWSFn:T,compression:h,lightMode:b}){f(this,A);y(this,"isActive",!1);y(this,"identity");y(this,"token");y(this,"db");y(this,"reducers");y(this,"setReducerFlags");y(this,"connectionId",Me.random());f(this,Se,0);f(this,k);f(this,ue,new Ne);f(this,Re);f(this,B);f(this,Ae,Promise.resolve());f(this,W,new Pr);y(this,"clientCache");y(this,"ws");y(this,"wsPromise");f(this,De,()=>{const e=s(this,Se);return u(this,Se,s(this,Se)+1),e});y(this,"subscriptionBuilder",()=>new Qt(this));de("info","Connecting to SpacetimeDB WS...");let z=new URL(`v1/database/${t}/subscribe`,e);/^wss?:/.test(e.protocol)||(z.protocol="ws:"),this.identity=r,this.token=n,u(this,B,c),u(this,k,i);let m=this.connectionId.toHexString();z.searchParams.set("connection_id",m),this.clientCache=new Fr,this.db=s(this,B).dbViewConstructor(this),this.setReducerFlags=s(this,B).setReducerFlagsConstructor(),this.reducers=s(this,B).reducersConstructor(this,this.setReducerFlags),this.wsPromise=T({url:z,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:h,lightMode:b}).then(S=>(this.ws=S,this.ws.onclose=()=>{s(this,k).emit("disconnect",this)},this.ws.onerror=F=>{s(this,k).emit("connectError",this,F)},this.ws.onopen=l(this,A,rr).bind(this),this.ws.onmessage=l(this,A,nr).bind(this),S)).catch(S=>{throw de("error","Error connecting to SpacetimeDB WS"),l(this,A,sr).call(this,"connectError",S),S})}registerSubscription(e,t,r){const n=s(this,De).call(this);return s(this,W).subscriptions.set(n,{handle:e,emitter:t}),l(this,A,Ie).call(this,te.SubscribeMulti({queryStrings:r,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){l(this,A,Ie).call(this,te.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,r){const n=te.CallReducer({reducer:e,args:t,requestId:0,flags:xr(r)});l(this,A,Ie).call(this,n)}disconnect(){this.wsPromise.then(e=>{e.close()})}onReducer(e,t){s(this,ue).on(e,t)}offReducer(e,t){s(this,ue).off(e,t)}},Se=new WeakMap,k=new WeakMap,ue=new WeakMap,Re=new WeakMap,B=new WeakMap,Ae=new WeakMap,W=new WeakMap,De=new WeakMap,A=new WeakSet,tr=async function(e){const t=(i,c,T)=>{const h=T.rowsData,b=new re(h),z=[],m=s(this,B).tables[c].rowType;for(;b.offset<h.length+h.byteOffset;){const S=m.deserialize(b),F=JSON.stringify(S,(x,$)=>typeof $=="bigint"?$.toString():$);z.push({type:i,rowId:F,row:S})}return z},r=async i=>{const c=i.tableName;let T=[];for(const h of i.updates){let b;if(h.tag==="Gzip"){const z=await Xt(h.value,"gzip");b=_e.deserialize(new re(z))}else{if(h.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");b=h.value}T=T.concat(t("insert",c,b.inserts)),T=T.concat(t("delete",c,b.deletes))}return{tableName:c,operations:T}},n=async i=>{const c=[];for(const T of i.tables)c.push(await r(T));return c};switch(e.tag){case"InitialSubscription":{const i=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await n(i)}}case"TransactionUpdateLight":{const i=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await n(i)}}case"TransactionUpdate":{const i=e.value,c=i.callerIdentity,T=Me.nullIfZero(i.callerConnectionId),h=i.reducerCall.reducerName,b=i.reducerCall.args,z=i.energyQuantaUsed;let m,S="";switch(i.status.tag){case"Committed":m=await n(i.status.value);break;case"Failed":m=[],S=i.status.value;break;case"OutOfEnergy":m=[];break}if(h==="<none>"){console.error(`Received an error from the database: ${S}`);return}let F;return h!==""&&(F={reducerName:h,args:b}),{tag:"TransactionUpdate",tableUpdates:m,identity:c,connectionId:T,reducerInfo:F,status:i.status,energyConsumed:z.quanta,message:S,timestamp:i.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"UnsubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error}}},Ie=function(e){this.wsPromise.then(t=>{const r=new N(1024);te.serialize(r,e);const n=r.getBuffer();t.send(n)})},rr=function(){this.isActive=!0},V=function(e,t){const r=[];for(let n of e){const i=n.tableName,c=s(this,B).tables[i],T=this.clientCache.getOrCreateTable(c);r.push(...T.applyOperations(n.operations,t))}return r},ir=async function(e){var n,i,c,T;const t=Ir(dt,e),r=await l(this,A,tr).call(this,t);if(r)switch(r.tag){case"InitialSubscription":{let h={tag:"SubscribeApplied"};const b=s(this,B).eventContextConstructor(this,h),{event:z,...m}=b,S=l(this,A,V).call(this,r.tableUpdates,b);s(this,k)&&((n=s(this,Re))==null||n.call(this,m));for(const F of S)F.cb();break}case"TransactionUpdateLight":{let h={tag:"UnknownTransaction"};const b=s(this,B).eventContextConstructor(this,h),z=l(this,A,V).call(this,r.tableUpdates,b);for(const m of z)m.cb();break}case"TransactionUpdate":{let h=r.reducerInfo,b=!1,z,m;if(!h)b=!0;else{m=s(this,B).reducers[h.reducerName];try{const K=new re(h.args);z=m.argsType.deserialize(K)}catch{console.debug("Failed to deserialize reducer arguments"),b=!0}}if(b){const K={tag:"UnknownTransaction"},kt=s(this,B).eventContextConstructor(this,K),cr=l(this,A,V).call(this,r.tableUpdates,kt);for(const or of cr)or.cb();return}h=h,m=m;const S={callerIdentity:r.identity,status:r.status,callerConnectionId:r.connectionId,timestamp:r.timestamp,energyConsumed:r.energyConsumed,reducer:{name:h.reducerName,args:z}},F={tag:"Reducer",value:S},x=s(this,B).eventContextConstructor(this,F),$={...x,event:S},ar=l(this,A,V).call(this,r.tableUpdates,x),Pt=[];m.argsType.product.elements.forEach((K,kt)=>{Pt.push(z[K.name])}),s(this,ue).emit(h.reducerName,$,...Pt);for(const K of ar)K.cb();break}case"IdentityToken":{this.identity=r.identity,!this.token&&r.token&&(this.token=r.token),this.connectionId=r.connectionId,s(this,k).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const h={tag:"SubscribeApplied"},b=s(this,B).eventContextConstructor(this,h),{event:z,...m}=b,S=l(this,A,V).call(this,r.tableUpdates,b);(i=s(this,W).subscriptions.get(r.queryId))==null||i.emitter.emit("applied",m);for(const F of S)F.cb();break}case"UnsubscribeApplied":{const h={tag:"UnsubscribeApplied"},b=s(this,B).eventContextConstructor(this,h),{event:z,...m}=b,S=l(this,A,V).call(this,r.tableUpdates,b);(c=s(this,W).subscriptions.get(r.queryId))==null||c.emitter.emit("end",m);for(const F of S)F.cb();break}case"SubscriptionError":{const h=Error(r.error),b={tag:"Error",value:h},m={...s(this,B).eventContextConstructor(this,b),event:h};r.queryId?(T=s(this,W).subscriptions.get(r.queryId))==null||T.emitter.emit("error",m,h):(console.error("Received an error message without a queryId: ",h),s(this,W).subscriptions.forEach(({emitter:S})=>{S.emit("error",m,h)}))}}},nr=function(e){u(this,Ae,s(this,Ae).then(()=>l(this,A,ir).call(this,e.data)))},sr=function(e,t){s(this,k).on(e,t)},Er=function(e,t){s(this,k).off(e,t)},Rr=function(e){s(this,k).on("connect",e)},Dr=function(e){s(this,k).on("disconnect",e)},Nr=function(e){s(this,k).on("connectError",e)},qr=function(e){s(this,k).off("connect",e)},Mr=function(e){s(this,k).off("disconnect",e)},Lr=function(e){s(this,k).off("connectError",e)},Wt),Tt;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Tt||(Tt={}));var Ce;(e=>{function t(){return a.createProductType([new o("message",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ce||(Ce={}));var bt;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(bt||(bt={}));var Fe;(e=>{function t(){return a.createProductType([new o("question",a.createStringType()),new o("options",a.createArrayType(a.createStringType())),new o("durationMinutes",a.createOptionType(a.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Fe||(Fe={}));var ft;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ft||(ft={}));var mt;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(mt||(mt={}));var wt;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(wt||(wt={}));var Oe;(e=>{function t(){return a.createProductType([new o("pollId",a.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Oe||(Oe={}));var Be;(e=>{function t(){return a.createProductType([new o("text",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Be||(Be={}));var Pe;(e=>{function t(){return a.createProductType([new o("name",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Pe||(Pe={}));var St;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(St||(St={}));var ke;(e=>{function t(){return a.createProductType([new o("newStatus",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ke||(ke={}));var At;(e=>{function t(){return a.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(At||(At={}));var xe;(e=>{function t(){return a.createProductType([new o("pollId",a.createU64Type()),new o("optionId",a.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(xe||(xe={}));class Hr{constructor(t){this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class $r{constructor(t){this.id={find:r=>{for(let n of this.tableCache.iter())if(ye(n.id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Wr{constructor(t){this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Kr{constructor(t){this.poll_id={find:r=>{for(let n of this.tableCache.iter())if(ye(n.poll_id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Vr{constructor(t){this.option_id={find:r=>{for(let n of this.tableCache.iter())if(ye(n.option_id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Gr{constructor(t){this.vote_id={find:r=>{for(let n of this.tableCache.iter())if(ye(n.vote_id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Zr{constructor(t){this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class Jr{constructor(t){this.identity={find:r=>{for(let n of this.tableCache.iter())if(ye(n.identity,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var zt;(e=>{function t(){return a.createProductType([new o("identity",a.createIdentityType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(zt||(zt={}));var It;(e=>{function t(){return a.createProductType([new o("id",a.createU32Type()),new o("message",a.createStringType()),new o("lastUpdated",a.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(It||(It={}));var _t;(e=>{function t(){return a.createProductType([new o("sender",a.createIdentityType()),new o("sent",a.createU64Type()),new o("text",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(_t||(_t={}));var Ut;(e=>{function t(){return a.createProductType([new o("pollId",a.createU64Type()),new o("question",a.createStringType()),new o("createdBy",a.createIdentityType()),new o("createdAt",a.createU64Type()),new o("expiresAt",a.createOptionType(a.createU64Type())),new o("active",a.createBoolType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ut||(Ut={}));var vt;(e=>{function t(){return a.createProductType([new o("optionId",a.createU64Type()),new o("pollId",a.createU64Type()),new o("text",a.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(vt||(vt={}));var Ct;(e=>{function t(){return a.createProductType([new o("voteId",a.createU64Type()),new o("voter",a.createIdentityType()),new o("pollId",a.createU64Type()),new o("optionId",a.createU64Type()),new o("votedAt",a.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ct||(Ct={}));var Ft;(e=>{function t(){return a.createProductType([new o("updateId",a.createU64Type()),new o("message",a.createStringType()),new o("timestamp",a.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ft||(Ft={}));var Ot;(e=>{function t(){return a.createProductType([new o("identity",a.createIdentityType()),new o("name",a.createOptionType(a.createStringType())),new o("online",a.createBoolType())])}e.getTypeScriptAlgebraicType=t;function r(i,c){e.getTypeScriptAlgebraicType().serialize(i,c)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ot||(Ot={}));const M={tables:{admin:{tableName:"admin",rowType:zt.getTypeScriptAlgebraicType()},current_status:{tableName:"current_status",rowType:It.getTypeScriptAlgebraicType(),primaryKey:"id"},message:{tableName:"message",rowType:_t.getTypeScriptAlgebraicType()},poll:{tableName:"poll",rowType:Ut.getTypeScriptAlgebraicType(),primaryKey:"poll_id"},poll_option:{tableName:"poll_option",rowType:vt.getTypeScriptAlgebraicType(),primaryKey:"option_id"},poll_vote:{tableName:"poll_vote",rowType:Ct.getTypeScriptAlgebraicType(),primaryKey:"vote_id"},update_log:{tableName:"update_log",rowType:Ft.getTypeScriptAlgebraicType()},user:{tableName:"user",rowType:Ot.getTypeScriptAlgebraicType(),primaryKey:"identity"}},reducers:{add_admin:{reducerName:"add_admin",argsType:Tt.getTypeScriptAlgebraicType()},add_update:{reducerName:"add_update",argsType:Ce.getTypeScriptAlgebraicType()},connect:{reducerName:"connect",argsType:bt.getTypeScriptAlgebraicType()},create_poll:{reducerName:"create_poll",argsType:Fe.getTypeScriptAlgebraicType()},debug_admins:{reducerName:"debug_admins",argsType:ft.getTypeScriptAlgebraicType()},disconnect:{reducerName:"disconnect",argsType:mt.getTypeScriptAlgebraicType()},force_init:{reducerName:"force_init",argsType:wt.getTypeScriptAlgebraicType()},manually_close_poll:{reducerName:"manually_close_poll",argsType:Oe.getTypeScriptAlgebraicType()},send_message:{reducerName:"send_message",argsType:Be.getTypeScriptAlgebraicType()},set_name:{reducerName:"set_name",argsType:Pe.getTypeScriptAlgebraicType()},test_log:{reducerName:"test_log",argsType:St.getTypeScriptAlgebraicType()},update_status:{reducerName:"update_status",argsType:ke.getTypeScriptAlgebraicType()},view_status:{reducerName:"view_status",argsType:At.getTypeScriptAlgebraicType()},vote_on_poll:{reducerName:"vote_on_poll",argsType:xe.getTypeScriptAlgebraicType()}},eventContextConstructor:(e,t)=>({...e,event:t}),dbViewConstructor:e=>new jr(e),reducersConstructor:(e,t)=>new Xr(e,t),setReducerFlagsConstructor:()=>new Yr};class Xr{constructor(t,r){this.connection=t,this.setCallReducerFlags=r}addAdmin(){this.connection.callReducer("add_admin",new Uint8Array(0),this.setCallReducerFlags.addAdminFlags)}onAddAdmin(t){this.connection.onReducer("add_admin",t)}removeOnAddAdmin(t){this.connection.offReducer("add_admin",t)}addUpdate(t){const r={message:t};let n=new N(1024);Ce.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("add_update",i,this.setCallReducerFlags.addUpdateFlags)}onAddUpdate(t){this.connection.onReducer("add_update",t)}removeOnAddUpdate(t){this.connection.offReducer("add_update",t)}onConnect(t){this.connection.onReducer("connect",t)}removeOnConnect(t){this.connection.offReducer("connect",t)}createPoll(t,r,n){const i={question:t,options:r,durationMinutes:n};let c=new N(1024);Fe.getTypeScriptAlgebraicType().serialize(c,i);let T=c.getBuffer();this.connection.callReducer("create_poll",T,this.setCallReducerFlags.createPollFlags)}onCreatePoll(t){this.connection.onReducer("create_poll",t)}removeOnCreatePoll(t){this.connection.offReducer("create_poll",t)}debugAdmins(){this.connection.callReducer("debug_admins",new Uint8Array(0),this.setCallReducerFlags.debugAdminsFlags)}onDebugAdmins(t){this.connection.onReducer("debug_admins",t)}removeOnDebugAdmins(t){this.connection.offReducer("debug_admins",t)}onDisconnect(t){this.connection.onReducer("disconnect",t)}removeOnDisconnect(t){this.connection.offReducer("disconnect",t)}forceInit(){this.connection.callReducer("force_init",new Uint8Array(0),this.setCallReducerFlags.forceInitFlags)}onForceInit(t){this.connection.onReducer("force_init",t)}removeOnForceInit(t){this.connection.offReducer("force_init",t)}manuallyClosePoll(t){const r={pollId:t};let n=new N(1024);Oe.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("manually_close_poll",i,this.setCallReducerFlags.manuallyClosePollFlags)}onManuallyClosePoll(t){this.connection.onReducer("manually_close_poll",t)}removeOnManuallyClosePoll(t){this.connection.offReducer("manually_close_poll",t)}sendMessage(t){const r={text:t};let n=new N(1024);Be.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("send_message",i,this.setCallReducerFlags.sendMessageFlags)}onSendMessage(t){this.connection.onReducer("send_message",t)}removeOnSendMessage(t){this.connection.offReducer("send_message",t)}setName(t){const r={name:t};let n=new N(1024);Pe.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("set_name",i,this.setCallReducerFlags.setNameFlags)}onSetName(t){this.connection.onReducer("set_name",t)}removeOnSetName(t){this.connection.offReducer("set_name",t)}testLog(){this.connection.callReducer("test_log",new Uint8Array(0),this.setCallReducerFlags.testLogFlags)}onTestLog(t){this.connection.onReducer("test_log",t)}removeOnTestLog(t){this.connection.offReducer("test_log",t)}updateStatus(t){const r={newStatus:t};let n=new N(1024);ke.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("update_status",i,this.setCallReducerFlags.updateStatusFlags)}onUpdateStatus(t){this.connection.onReducer("update_status",t)}removeOnUpdateStatus(t){this.connection.offReducer("update_status",t)}viewStatus(){this.connection.callReducer("view_status",new Uint8Array(0),this.setCallReducerFlags.viewStatusFlags)}onViewStatus(t){this.connection.onReducer("view_status",t)}removeOnViewStatus(t){this.connection.offReducer("view_status",t)}voteOnPoll(t,r){const n={pollId:t,optionId:r};let i=new N(1024);xe.getTypeScriptAlgebraicType().serialize(i,n);let c=i.getBuffer();this.connection.callReducer("vote_on_poll",c,this.setCallReducerFlags.voteOnPollFlags)}onVoteOnPoll(t){this.connection.onReducer("vote_on_poll",t)}removeOnVoteOnPoll(t){this.connection.offReducer("vote_on_poll",t)}}class Yr{constructor(){this.addAdminFlags="FullUpdate",this.addUpdateFlags="FullUpdate",this.createPollFlags="FullUpdate",this.debugAdminsFlags="FullUpdate",this.forceInitFlags="FullUpdate",this.manuallyClosePollFlags="FullUpdate",this.sendMessageFlags="FullUpdate",this.setNameFlags="FullUpdate",this.testLogFlags="FullUpdate",this.updateStatusFlags="FullUpdate",this.viewStatusFlags="FullUpdate",this.voteOnPollFlags="FullUpdate"}addAdmin(t){this.addAdminFlags=t}addUpdate(t){this.addUpdateFlags=t}createPoll(t){this.createPollFlags=t}debugAdmins(t){this.debugAdminsFlags=t}forceInit(t){this.forceInitFlags=t}manuallyClosePoll(t){this.manuallyClosePollFlags=t}sendMessage(t){this.sendMessageFlags=t}setName(t){this.setNameFlags=t}testLog(t){this.testLogFlags=t}updateStatus(t){this.updateStatusFlags=t}viewStatus(t){this.viewStatusFlags=t}voteOnPoll(t){this.voteOnPollFlags=t}}class jr{constructor(t){this.connection=t}get admin(){return new Hr(this.connection.clientCache.getOrCreateTable(M.tables.admin))}get currentStatus(){return new $r(this.connection.clientCache.getOrCreateTable(M.tables.current_status))}get message(){return new Wr(this.connection.clientCache.getOrCreateTable(M.tables.message))}get poll(){return new Kr(this.connection.clientCache.getOrCreateTable(M.tables.poll))}get pollOption(){return new Vr(this.connection.clientCache.getOrCreateTable(M.tables.poll_option))}get pollVote(){return new Gr(this.connection.clientCache.getOrCreateTable(M.tables.poll_vote))}get updateLog(){return new Zr(this.connection.clientCache.getOrCreateTable(M.tables.update_log))}get user(){return new Jr(this.connection.clientCache.getOrCreateTable(M.tables.user))}}class Qr extends Qt{}const Bt=class Bt extends er{constructor(){super(...arguments),this.subscriptionBuilder=()=>new Qr(this)}};Bt.builder=()=>new Br(M,t=>t);let Rt=Bt;export{Tt as AddAdmin,Ce as AddUpdate,zt as Admin,Hr as AdminTableHandle,bt as Connect,Fe as CreatePoll,It as CurrentStatus,$r as CurrentStatusTableHandle,Rt as DbConnection,ft as DebugAdmins,mt as Disconnect,wt as ForceInit,Oe as ManuallyClosePoll,_t as Message,Wr as MessageTableHandle,Ut as Poll,vt as PollOption,Vr as PollOptionTableHandle,Kr as PollTableHandle,Ct as PollVote,Gr as PollVoteTableHandle,Xr as RemoteReducers,jr as RemoteTables,Be as SendMessage,Pe as SetName,Yr as SetReducerFlags,Qr as SubscriptionBuilder,St as TestLog,Ft as UpdateLog,Zr as UpdateLogTableHandle,ke as UpdateStatus,Ot as User,Jr as UserTableHandle,At as ViewStatus,xe as VoteOnPoll};
